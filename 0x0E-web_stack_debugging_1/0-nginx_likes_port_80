#!/usr/bin/env bash
# Ensure the system is updated and install Nginx
apt update && apt install -y nginx

# Ensure Nginx starts on boot and is running
systemctl enable --now nginx

# Ensure firewall allows HTTP traffic (if UFW is active)
ufw allow 80/tcp || true

# Ensure Nginx is listening on all IPv4 interfaces for port 80
sed -i '/listen 80 default_server;/c\    listen 80;' /etc/nginx/sites-available/default
sed -i '/listen \[::\]:80 default_server;/c\    listen [::]:80;' /etc/nginx/sites-available/default

# Reload Nginx to apply changes
nginx -t && systemctl restart nginx
